
opentelemetry-collector:

  mode: daemonset



  image:

    repository: otel/opentelemetry-collector-contrib

    tag: "0.121.0"



  # 暴露 metrics 端口（Service + container ports）

  ports:

    metrics:

      enabled: true

      containerPort: 8888

      servicePort: 8888

      protocol: TCP



  service:

    enabled: true



  config:

    receivers:

      otlp:

        protocols:

          grpc:

            endpoint: 0.0.0.0:4317

          http:

            endpoint: 0.0.0.0:4318



    processors:

      memory_limiter:

        check_interval: 5s

        limit_percentage: 80

        spike_limit_percentage: 25

      batch: {}



    exporters:

      otlp/gateway:

        endpoint: otel-gateway-dev-opentelemetry-collector:4317

        tls:

          insecure: true



    service:

      telemetry:

        metrics:

          address: 0.0.0.0:8888

      pipelines:

        traces:

          receivers: [otlp]

          processors: [memory_limiter, batch]

          exporters: [otlp/gateway]

        metrics:

          receivers: [otlp]

          processors: [memory_limiter, batch]

          exporters: [otlp/gateway]

        logs:

          receivers: [otlp]

          processors: [memory_limiter, batch]

          exporters: [otlp/gateway]

