prometheus:
  serverFiles:
    prometheus.yml:
      scrape_configs:
        - job_name: otel-gateway-dev
          metrics_path: /metrics
          static_configs:
            - targets:
                - otel-gateway-dev-opentelemetry-collector.otel-dev.svc.cluster.local:8888

        - job_name: otel-agent-dev
          metrics_path: /metrics
          static_configs:
            - targets:
                - otel-agent-dev-opentelemetry-collector.otel-dev.svc.cluster.local:8888

    alerting_rules.yml:
      groups:
        - name: otel-collector.rules
          rules:
            - alert: OTelCollectorExporterQueueSaturationHigh
              expr: (otelcol_exporter_queue_size{job=~"otel-(gateway|agent)-dev"} / otelcol_exporter_queue_capacity{job=~"otel-(gateway|agent)-dev"}) > 0.8
              for: 10m
              labels:
                severity: warning
              annotations:
                summary: "OTel Collector exporter queue saturation high"
                description: "Exporter queue is >80% for 10m on {{ $labels.job }} exporter={{ $labels.exporter }} instance={{ $labels.instance }}"

            - alert: OTelCollectorExporterSendFailed
              expr: sum by (job, exporter) (rate({__name__=~"otelcol_exporter_send_failed_.*",job=~"otel-(gateway|agent)-dev"}[5m])) > 0
              for: 5m
              labels:
                severity: critical
              annotations:
                summary: "OTel Collector exporter send failures"
                description: "Exporter has send failures in last 5m on {{ $labels.job }} exporter={{ $labels.exporter }}"
